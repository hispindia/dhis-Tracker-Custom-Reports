
<script>
var myVar;

(function myFunction() {
    myVar = setTimeout(showPage, 10000);
})();

function showPage() {
  document.getElementById("loader").style.display = "none";
  document.getElementById("myDiv").style.display = "block";
}
</script>
<script type="text/javascript">
    //program --IN 3Si - Sanitation enterprise linking with 3Si
    var periods = dhis2.report.periods;
    var period = periods[0];
    var orgUnit = dhis2.report.organisationUnit;
    orgUnit.parent = dhis2.report.organisationUnitHierarchy[1];
    var orgUnitChildren = dhis2.report.organisationUnitChildren;
    var orgUnitUIDs = "";

    var prgUID = "TbYUPaBChYR";
    var def_stage1,def_stage2,def_stage3,def_stage4,def_stage5,def_stage6,def_stage7,def_stage8;
    var tableDataHtml, tableDataHtml1, tableDataHtml2,tableDataHtml3;


    //var orgnUnit ="tZJsIdHAfKq";

    //*******************************************************
    var progId="cs9lkDp5O4m";
    var programStageNum;
    var progStages =[];
    var stage1 ="CJuhZv1vbwo";
    var SSPName=[],BDMName=[];

    var hashmapArrayA =[], objA=[],objB=[], objC=[], objD=[] ;


    //*******************************************************


    if (jQuery.when.all === undefined) {
        jQuery.when.all = function (deferreds) {
            var deferred = new jQuery.Deferred();
            $.when.apply(jQuery, deferreds).then(
                    function () {
                        deferred.resolve(Array.prototype.slice.call(arguments));
                    },
                    function () {
                        deferred.fail(Array.prototype.slice.call(arguments));
                    });

            return deferred;
        }
    }


    var tableDX = [


        { dxName: "PK RH FP-Clients followed-up", dxId: "NoGwMfqdSOY", cocId: "" },
        { dxName: "PK RH FP-IPC FFM first client MWRA ID", dxId: "qbK1eGEgVD4", cocId: "" },
        { dxName: "PK RH FP-IPC FFM referral tokens issued", dxId: "gBdx1XMCySe", cocId: "" },
        { dxName: "PK RH FP IPC FFM last client MWRA ID", dxId: "vKpDeWYKhHk", cocId: "" },
        { dxName: "PK RH FP-Orientation meeting participants", dxId: "Pusk3tS9CEP", cocId: "" },
        { dxName: "PK RH FP-Neighbourhood meeting participants", dxId: "dvLvzUaJeQh", cocId: "" },
        { dxName: "PK RH FP-IPC FFM clients visited", dxId: "nUqWTyxWCZs", cocId: "" }
    ];


    var deUIDs = "";

    var url = window.location.href;
    var params = url.split('=');
    var gotPeriod = params[2];
    var cYear = parseInt(gotPeriod.substring(0, 4));
    var showingTable = "datavalue1";
    var den =[];
    var periodsStr = "";
    jQuery(document).ready(function () {

        //var cMonth = parseInt(gotPeriod.substring(4, 6));
        periodsStr = cYear+"01;"+cYear+"02;"+cYear+"03;"+cYear+"04;"+cYear+"05;"+cYear+"06;"+cYear+"07;"+cYear+"08;"+cYear+"09;"+cYear+"10;"+cYear+"11;"+cYear+"12;";
        // console.log("dsifj"+periodsStr);

        //  $.get("../api/analytics.json?dimension=dx:nqPVG2KDPgg&dimension=pe:" + periodsStr + "&filter=ou:taxRmsyn5XB&displayProperty=NAME", function (progIndiVal) {
        $.get("../api/analytics.json?dimension=dx:FxKXZ2vVrys&dimension=pe:" + periodsStr + "&filter=ou:taxRmsyn5XB&displayProperty=NAME", function (progIndiVal) {

            for (var k = 0; k < progIndiVal.rows.length; k++) {
                den.push(progIndiVal.rows[k][2]);

            }
        });
        loadDataX();
        //validateReport();
        $(".hideInPrint").hide();
        orgUnitChildren.sort(function (a, b) {
            if (a.name < b.name)
                return -1;
            if (a.name > b.name)
                return 1;
            return 0;
        });

        $.each(tableDX, function () {
            deUIDs += this.dxId + ";";
        });

        $.each(orgUnitChildren, function () {
            orgUnitUIDs += this.id + ";";
        });

        //    loadDataX();
        $("#datepicker").datepicker({dateFormat: "dd/mm/yy"});
        $("#datepicker1").datepicker({dateFormat: "dd/mm/yy"});


        $("#btnExport").click(function (e) {
            window.open('data:application/vnd.ms-excel,' + encodeURIComponent($('#printing').html()));
            e.preventDefault();
        });
    });

    function validateReport() {
        $.get("../api/organisationUnitGroups/hdvIWjIWixd?filter=organisationUnits.id:eq:" + orgUnit.id, function (json) {

            if (!json.name) {
                alert("Selected Facility is not in Intervention OU Group");
                window.history.back();
            }
            else {
                loadData();
            }
        });
    }


    function getPeriod(pr) {
        var year = pr.substring(0, 4);
        var month = pr.substring(4, 6);
        var strMonth = "";

        if (month == "01" || month == "1")        strMonth = "January";
        else if (month == "02" || month == "2")    strMonth = "February";
        else if (month == "03" || month == "3")    strMonth = "March";
        else if (month == "04" || month == "4")    strMonth = "April";
        else if (month == "05" || month == "5")    strMonth = "May";
        else if (month == "06" || month == "6")    strMonth = "June";
        else if (month == "07" || month == "7")    strMonth = "July";
        else if (month == "08" || month == "8")    strMonth = "August";
        else if (month == "09" || month == "9")    strMonth = "September";
        else if (month == "10")                strMonth = "October";
        else if (month == "11")                strMonth = "November";
        else if (month == "12")                strMonth = "December";

        return strMonth + " " + year;
    }


    //    var cYear = parseInt(gotPeriod.substring(0, 4));
       var cMonth = parseInt(gotPeriod.substring(4, 6));
    //    var periodsStr = cYear+"01;"+cYear+"02;"+cYear+"03;"+cYear+"04;"+cYear+"05;"+cYear+"06;"+cYear+"07;"+cYear+"08;"+cYear+"09;"+cYear+"10;"+cYear+"11;"+cYear+"12;";
    //    // console.log("dsifj"+periodsStr);
    var jsonData1;
    var jsonData2;
    var jsonData3;
    var c = 0;

    function loadData() {
        document.getElementById('selectedOUName').innerHTML = orgUnit.name;
        //document.getElementById('selectedOUName').innerHTML = 'Bihar';
        document.getElementById('period').innerHTML = cYear;

        //http://localhost:8090/dhis221/api/analytics.json?dimension=pe:THIS_MONTH&dimension=dx:fftwX6D3iuI;vMISOrzIDPL;Y3sftYIwjSx;Nr8JvumTkmZ;lO9hVUqHo9v;xi0iWC3fLH5;XWBvNBGaek0;xJbKdiq41l3&dimension=ou:Xyeh1Hkiz0i;IsDCrC4yKIB;VKvtcjd4XC3;R0DM4NKU4iX;gXg0zlcO1Xt;EjHkVXiw2tR;b0rHfpNxUUm;zUGO5Ho7Aqb&program=icAx8KDM1WT
        var url = "../api/analytics.json?dimension=dx:" + deUIDs + "&dimension=ou:" + orgUnitUIDs + "&dimension=pe:" + periodsStr + "&program=" + prgUID;

        console.log(url);
        $.get(url, function (json) {


            console.log("************************URL: " + url);

            jsonData1 = json;
            //console.log( jsonData1 );

            loadReport();
        });

    }

    function prepareIdToObjectMap(object, id) {
        var map = [];
        for (var i = 0; i < object.length; i++) {
            map[object[i][id]] = object[i];
        }
        return map;
    }

    function loadDataX() {
        //

        if($("#datepicker").datepicker("getDate") === null) {
            alert("Please select start date");
        }
        else if($("#datepicker1").datepicker("getDate") === null) {
            alert("Please select end date");
        }

        def_stage1 = $.Deferred();
        var monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        var d = new Date();
      //  document.write("The current month is " + monthNames[d.getMonth()]);
var currMonth;
        if(monthNames[d.getMonth()] == "January"){
            currMonth = "01";
        }
        else if(monthNames[d.getMonth()] == "February"){
            currMonth = "02";
        }
        else if(monthNames[d.getMonth()] == "March"){
            currMonth = "03";
        }
        else if(monthNames[d.getMonth()] == "April"){
            currMonth = "04";
        }
        else if(monthNames[d.getMonth()] == "May"){
            currMonth = "05";
        }
        else if(monthNames[d.getMonth()] == "June"){
            currMonth = "06";
        }
        else if(monthNames[d.getMonth()] == "July"){
            currMonth = "07";
        }
        else if(monthNames[d.getMonth()] == "August"){
            currMonth = "08";
        }
        else if(monthNames[d.getMonth()] == "September"){
            currMonth = "09";
        }
        else if(monthNames[d.getMonth()] == "October"){
            currMonth = "10";
        }
        else if(monthNames[d.getMonth()] == "November"){
            currMonth = "11";
        }
        else if(monthNames[d.getMonth()] == "December"){
            currMonth = "12";
        }
        /* var a = document.getElementById('datepicker').value;
         startDate = a.split("/").reverse().join("-");


         var b = document.getElementById('datepicker1').value;
         endDate = b.split("/").reverse().join("-");

         console.log(startDate);
         console.log(endDate);

         var periodStr = a + " " + "to" + " " + b;
         console.log(periodStr);*/
        var events = [];
        //document.getElementById('selectedOUName').innerHTML = orgUnit.name;
        document.getElementById('selectedOUName').innerHTML = 'Bihar';
        // document.getElementById('period').innerHTML = periodStr;
        document.getElementById('period').innerHTML = cYear;
        // prepare table header </table>

        var headerHtml = "<thead  ><tr  bgcolor='#F2DDDC' ><th  rowspan='1' ><center>S No.</center></th>" +
                        "<th rowspan='1'><center>Enterprise Performance (Toilet Sold)</center></th>" +
                        "<th  rowspan='1'><center>Jan</center></th>" +
                        "<th rowspan='1'><center>Feb</center></th>" +
                        "<th rowspan='1'><center>Mar</center></th>" +
                        "<th rowspan='1'><center>Apr</center></th>" +
                        "<th rowspan='1'><center>May</center></th>" +
                        "<th rowspan='1'><center>June</center></th>" +
                        "<th rowspan='1'><center>July</center></th>" +
                        "<th rowspan='1'><center>Aug</center></th>" +
                        "<th rowspan='1'><center>Sep</center></th>" +
                        "<th rowspan='1'><center>Oct</center></th>" +
                        "<th rowspan='1'><center>Nov</center></th>" +
                        "<th rowspan='1'><center>Dec</center></th></tr>"

//                "<tr id='abc'><td bgcolor='#F2DDDC' colspan='1'>1</td><td bgcolor='#F2DDDC' colspan='1'>% of Enterprises are in Category A</td></tr>"+
//                "<tr  bgcolor='#F2DDDC' ><td colspan='1'>2</td><td bgcolor='#F2DDDC' colspan='1'>% of Enterprises are in Category B</td></tr>"+
//               "<tr  bgcolor='#F2DDDC' ><td colspan='1'>3</td><td bgcolor='#F2DDDC' colspan='1'>% of Enterprises are in Category C</td></tr>"+
//                "<tr  bgcolor='#F2DDDC' ><td colspan='1'>4</td><td bgcolor='#F2DDDC' colspan='1'>% of Enterprises are in Category D</td></tr>"


                ;



        headerHtml = headerHtml + "</tr></thead>";
        $('#datavalue1').html("");

        $('#datavalue1').append(headerHtml);

        tableDataHtml = "<tbody><tr>";
        tableDataHtml1 = "<tbody><tr>";
        tableDataHtml2 = "<tbody><tr>";
        tableDataHtml3 = "<tbody><tr>";
period= cYear+currMonth;

        var months = [cYear+"01",cYear+"02",cYear+"03",cYear+"04",cYear+"05",cYear+"06",cYear+"07",cYear+"08",cYear+"09",cYear+"10",cYear+"11",cYear+"12"];
        console.log("months--"+months);
        var result =[], resultB =[],resultC =[],resultD =[];
var denom=0;

        var promiseQueueA = [];
       for(var i=1; i<=12;i++){
            promiseQueueA.push(categoryA(i));


      }
        $.when.apply($, promiseQueueA) // happens now
                .then(function () {

                    result = sortArr(months, objA);
                    createTD(result);

                    resultB = sortArr(months, objB);
                    createTDB(resultB);

                    resultC = sortArr(months, objC);
                    createTDC(resultC);

                    resultD = sortArr(months, objD);
                    createTDD(resultD);


                }, function (e) {
                    console.log("promise queue error : "+e);
                });


        function sortArr(months, attributeArr) {
            var res = [];
            for (var i = 0; i < months.length; i++) {
                var check = 0;
                var item = {};
                item["name"] = months[i];
                for (var j = 0; j < attributeArr.length; j++) {
                    if (months[i] == attributeArr[j].period) {
                        item["value"] = attributeArr[j].value;
                        item["den"] = attributeArr[j].den;

                        check = 1;
                        break;
                    }
                }
                if (check == 0) {
                    item["value"] = "0";
                    item["den"] = "1";

                }
                res.push(item);


            }

            return res;

        }


        function createTD(result){

            tableDataHtml = tableDataHtml + "<td><center>" +"1"+ "</center></td>";
            tableDataHtml = tableDataHtml + "<td><center>" +"% of Enterprises are in Category A" + "</center></td>";

             for (var i=0; i<result.length;i++){


            tableDataHtml = tableDataHtml + "<td><center>" + (((result[i].value)/result[i].den)*100).toFixed(2) + "</center></td>";

              }
            //  }
            // $('#datavalue1').append(tableDataHtml);

        }

        function createTDB(resultB) {

            tableDataHtml1 = tableDataHtml1 + "<td><center>" + "2" + "</center></td>";
            tableDataHtml1 = tableDataHtml1 + "<td><center>" + "% of Enterprises are in Category B" + "</center></td>";

              for (var i = 0; i < resultB.length; i++){
            tableDataHtml1 = tableDataHtml1 + "<td><center>" + (((resultB[i].value)/resultB[i].den)*100).toFixed(2) + "</center></td>";

              }

        }

        function createTDC(resultC){

            tableDataHtml2 = tableDataHtml2 + "<td><center>" +"3"+ "</center></td>";
            tableDataHtml2 = tableDataHtml2 + "<td><center>" +"% of Enterprises are in Category C" + "</center></td>";

              for (var i=0; i<resultC.length;i++){


            tableDataHtml2 = tableDataHtml2 + "<td><center>" +(((resultC[i].value)/resultC[i].den)*100).toFixed(2) + "</center></td>";

             }

            //   $('#datavalue1').append(tableDataHtml,tableDataHtml1,tableDataHtml2);
        }

        function createTDD(resultD){

            tableDataHtml3 = tableDataHtml3 + "<td><center>" +"4"+ "</center></td>";
            tableDataHtml3 = tableDataHtml3 + "<td><center>" +"% of Enterprises are in Category D" + "</center></td>";

             for (var i=0; i<resultD.length;i++){

            tableDataHtml3 = tableDataHtml3 + "<td><center>" +(((resultD[i].value)/resultD[i].den)*100).toFixed(2)+ "</center></td>";

             }

            $('#datavalue1').append(tableDataHtml,tableDataHtml1,tableDataHtml2,tableDataHtml3);
        }

        function categoryA() {
            var def = $.Deferred();
            if (i < 10) {

                period = cYear + "0" + i;

            }
            else {
                period = cYear + '' + i;

            }


            $.get("../api/analytics/events/aggregate/" + progId + ".json?stage=" + stage1 + "&dimension=ou:taxRmsyn5XB&dimension=pe:" + period + "&dimension=q36QGU3E4AI&outputType=EVENT&displayProperty=NAME", function (data) {
            console.log("../api/analytics/events/aggregate/" + progId + ".json?stage=" + stage1 + "&dimension=ou:taxRmsyn5XB&dimension=pe:" + period + "&dimension=q36QGU3E4AI&outputType=EVENT&displayProperty=NAME");

                var  categoryACount = 0,categoryBCount = 0,categoryCCount = 0,categoryDCount = 0 ;

                var hashmapA = [], hashmapB = [], hashmapC = [], hashmapD = [];
                if (data.rows.length > 0) {
                    for (var j = 0; j < data.rows.length; j++) {


                        denom = data.rows.length; //A,B,C,D belongs to one of the category, so total Acount+Bcount+Ccount+Dcount belongs to total rows

                        if (data.rows[j][3] >= 60) {
                            categoryACount++;
                            hashmapA['period'] = data.rows[j][2];
                            hashmapA['value'] = categoryACount;
                            hashmapA['den'] = denom;
                        }
                        else if (data.rows[j][3] >= 30 && data.rows[j][3] < 59) {
                            categoryBCount++;
                            hashmapB['period'] = data.rows[j][2];
                            hashmapB['value'] = categoryBCount;
                            hashmapB['den'] = denom;

                        }
                        else if (data.rows[j][3] < 30 && data.rows[j][3]>0) {
                            categoryCCount++;
                            hashmapC['period'] = data.rows[j][2];
                            hashmapC['value'] = categoryCCount;
                            hashmapC['den'] = denom;

                        }
                        else if (data.rows[j][3] == 0) {

                            categoryDCount++;
                            hashmapD['period'] = data.rows[j][2];
                            hashmapD['value'] = categoryDCount;
                            hashmapD['den'] = denom;

                        }

                      /*  else {
                            hashmapA['period'] = data.rows[j][2];
                            hashmapA['value'] = categoryACount;

                            hashmapB['period'] = data.rows[j][2];
                            hashmapB['value'] = categoryBCount;

                            hashmapC['period'] = data.rows[j][2];
                            hashmapC['value'] = categoryCCount;

                            hashmapD['period'] = data.rows[j][2];
                            hashmapD['value'] = categoryDCount;

                        }*/
                    }

                    objA.push(hashmapA);
                    objB.push(hashmapB);
                    objC.push(hashmapC);
                    objD.push(hashmapD);
                }
                else {
                    hashmapA['period'] = data.metaData.pe[0];
                    hashmapA['value'] = 0;
                    hashmapA['den'] = denom;

                    hashmapB['period'] = data.metaData.pe[0];
                    hashmapB['value'] = 0;
                    hashmapB['den'] = denom;

                    hashmapC['period'] = data.metaData.pe[0];
                    hashmapC['value'] = 0;
                    hashmapC['den'] = denom;

                    hashmapD['period'] = data.metaData.pe[0];
                    hashmapD['value'] = 0;
                    hashmapD['den'] = denom;

                    objA.push(hashmapA);
                    objB.push(hashmapB);
                    objC.push(hashmapC);
                    objD.push(hashmapD);
                }

             //   denom = categoryACount+categoryBCount+categoryCCount+categoryDCount;
                def.resolve();

            });

            return def.promise();
        }


        //   $('#datavalue1').append(tableDataHtml);


    }


    function downloadReport()
    {

        tablesToExcel(['datavalue1'], ['3Si - Sanitation enterprise'], '3Si - Sanitation enterprise.xls');
    }





</script>
<script type="text/javascript">

    function fnExcelReport()
    {
        var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
        var textRange; var j=0;
        tab = document.getElementById('datavalue1'); // id of table

        for(j = 0 ; j < tab.rows.length ; j++)
        {
            tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
            //tab_text=tab_text+"</tr>";
        }

        tab_text=tab_text+"</table>";
        tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
        tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
        tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");

        if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
        {
            txtArea1.document.open("txt/html","replace");
            txtArea1.document.write(tab_text);
            txtArea1.document.close();
            txtArea1.focus();
            sa=txtArea1.document.execCommand("SaveAs",true,"Book.xls");
        }
        else                 //other browser not tested on IE 11
            sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));

        return (sa);
    }
</script>

<!-- download script ------------------------------------------------------
		--------------------------------------------------------------------------
		-------------------------------------------------------------------------------------- -->
<script type="text/javascript">
    var tablesToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,', tmplWorkbookXML = '<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">' + '<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office"><Author>ThaiND</Author><Created>{created}</Created></DocumentProperties>' + '<Styles><Style ss:ID="Default" ss:Name="Normal"><Alignment ss:Horizontal="Center" ss:WrapText="1"/><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1"/></Borders><Font/><Interior /><NumberFormat /><Protection /></Style><Style ss:ID="s21"><Alignment ss:WrapText="1" ss:Horizontal="Center" ss:Vertical="Center"/><Font ss:Size="10" ss:Bold="1" /><Interior ss:Color="#999999" ss:Pattern="Solid" /><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1"/></Borders></Style> <Style ss:ID="s22"><Alignment ss:WrapText="1" ss:Horizontal="Center" ss:Vertical="Center"/><Font ss:Size="10" ss:Bold="1" /><Interior ss:Color="#999999" ss:Pattern="Solid" /><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1"/></Borders></Style><Style ss:ID="s64"> <Alignment ss:WrapText="1" ss:Horizontal="Center" ss:Vertical="Center" ss:Indent="0" ss:Rotate="90"/><Font ss:Size="10" ss:Bold="1" /><Interior ss:Color="#999999" ss:Pattern="Solid" /> </Style> </Styles>' + '{worksheets}</Workbook>', tmplWorksheetXML = '<Worksheet ss:Name="{nameWS}"><Table><Column ss:AutoFitWidth="0" ss:Width="100"/><Column ss:AutoFitWidth="0" ss:Width="150"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/><Column ss:AutoFitWidth="0" ss:Width="80"/>{rows}</Table></Worksheet>', tmplCellXML = '<Cell ss:StyleID="{sid}" ss:MergeAcross="{mrg}"><Data ss:Type="{dtype}">{data}</Data></Cell>', base64 = function (s) {
                    return window.btoa(unescape(encodeURIComponent(s)))
                }
                , format = function (s, c) {
                    return s.replace(/{(\w+)}/g, function (m, p) {
                        return c[p];
                    })
                }

        return function (tables, wsnames, wbname) {
            var ctx = "";
            var workbookXML = "";
            var worksheetsXML = "";
            var rowsXML = "";

            for (var i = 0; i < tables.length; i++) {

                if (!tables[i].nodeType)
                    tables[i] = document.getElementById(tables[i]);

                for (var j = 0; j < tables[i].rows.length; j++) {
                    rowsXML += '<Row>'
                    for (var k = 0; k < tables[i].rows[j].cells.length; k++) {

                        var cols = tables[i].rows[j].cells[k].getAttribute("colspan");
                        var rws = tables[i].rows[j].cells[k].getAttribute("rowspan");
                        var styl = tables[i].rows[j].cells[k].getAttribute("bgcolor");
                        var styl2 = tables[i].rows[j].getAttribute("bgcolor");
                        var cls = tables[i].rows[j].cells[k].getAttribute("class");

                        var dataType = 'String';
                        var dataValue = tables[i].rows[j].cells[k].innerHTML;
                        var typeD = "";
                        var parsed = parseInt(dataValue);

                        if (parsed == dataValue) {
                            typeD = "Number";
                        }
                        else {
                            typeD = "String";
                        }


                        if (styl2) {
                            if (cols) {
                                if (cls == "aso") {
                                    ctx = {data: dataValue, mrg: cols - 1, sid: "s64", dtype: typeD};
                                    rowsXML += format(tmplCellXML, ctx);
                                }
                                else {
                                    ctx = {data: dataValue, mrg: cols - 1, sid: "s22", dtype: typeD};
                                    rowsXML += format(tmplCellXML, ctx);
                                }
                            }

                            else {
                                if (cls == "aso") {
                                    ctx = {data: dataValue, mrg: 0, sid: "s64", dtype: typeD};
                                    rowsXML += format(tmplCellXML, ctx);
                                }
                                else {
                                    ctx = {data: dataValue, mrg: 0, sid: "s22", dtype: typeD};
                                    rowsXML += format(tmplCellXML, ctx);
                                }
                            }
                        }

                        else if (styl) {
                            if (cols) {
                                ctx = {data: dataValue, mrg: cols - 1, sid: "s21", dtype: typeD};
                                rowsXML += format(tmplCellXML, ctx);
                            }

                            else {
                                ctx = {data: dataValue, mrg: 0, sid: "s21", dtype: typeD};
                                rowsXML += format(tmplCellXML, ctx);
                            }
                        }

                        else {
                            if (cols) {
                                ctx = {data: dataValue, mrg: cols - 1, sid: "Default", dtype: typeD};
                                rowsXML += format(tmplCellXML, ctx);
                            }

                            else {
                                ctx = {data: dataValue, mrg: 0, sid: "Default", dtype: typeD};
                                rowsXML += format(tmplCellXML, ctx);
                            }

                        }

                    }
                    rowsXML += '</Row>'
                }
                ctx = {rows: rowsXML, nameWS: wsnames[i] || 'Sheet' + i};
                worksheetsXML += format(tmplWorksheetXML, ctx);
                rowsXML = "";
            }

            ctx = {created: (new Date()).getTime(), worksheets: worksheetsXML};
            workbookXML = format(tmplWorkbookXML, ctx);

            //console.log(workbookXML);

            var link = document.createElement("A");
            link.href = uri + base64(workbookXML);
            link.download = wbname || 'Workbook.xls';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    })();
</script>
<script type="text/javascript">
    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }
</script>
<p><span style="font-size:12px;">
<style>
    th {
        text-align: center;
    }

    td {
        padding: 3px 7px;

    }

    .bd {
        border-style: solid;
        border-color: #000000;
    }

    #cover {
        position: fixed;
        top: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 5;
        width: 100%;
        height: 100%;
    }

    #loads {
        height: 100px;
        width: 500px;
        position: fixed;
        z-index: 10;
        margin: 0 auto;
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -250px;
        background: #999;
        border: 5px solid #cccccc;
        text-align : center;
        border-radius: 5px;
    }

    .loading {
        width: 400px;
        font-size: 20px;
        font-family: verdana;
        font-weight: bolder;
        position: fixed;
        top: 50%;
        left: 50%;
        margin: 0 auto;
        margin-top: -8px;
        margin-left: -200px;
    }
    #load{
        width:100%;
        height:100%;
        position:fixed;
        z-index:9999;
        background:url("https://www.creditmutuel.fr/cmne/fr/banques/webservices/nswr/images/loading.gif") no-repeat center center rgba(0,0,0,0.25)
    }



</style>
<style>
/* Center the loader */
#loader {
  position: absolute;
  left: 50%;
  top: 50%;
  z-index: 1;
  width: 150px;
  height: 150px;
  margin: -75px 0 0 -75px;
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Add animation to "page content" */
.animate-bottom {
  position: relative;
  -webkit-animation-name: animatebottom;
  -webkit-animation-duration: 1s;
  animation-name: animatebottom;
  animation-duration: 1s
}

@-webkit-keyframes animatebottom {
  from { bottom:-100px; opacity:0 } 
  to { bottom:0px; opacity:1 }
}

@keyframes animatebottom { 
  from{ bottom:-100px; opacity:0 } 
  to{ bottom:0; opacity:1 }
}

#myDiv {
  display: none;
  text-align: center;
}
</style>

</span></p>
<div id="loader"></div>

<div tyle="display:none;" id="myDiv" class="animate-bottom">
		<table>
			<tr>
				<td>
					<input type="button" id="btnBack" value=" Go to Dashboard" onclick="location.href='../dhis-web-dashboard-integration/index.action'"/>
					<input type="button" onclick="printContent('printing');" value="Print"/>
					<input type="button" id="btnExport" value=" Export to Excel " />

				</td>
			</tr>
		</table>


		</br></br>
		</br></br>

		<div id="printing">
			<table width="100%">
			   
							<tr align="center" height="27" width="100%">
								<td height="27" class="col" colspan="14" bgcolor="#32849C"><font color="white"><b> Enterprise performance Report
								</b></font></td>
							</tr>
							<tr bgcolor="#F2DDDC" align="center" height="20" width="100%">
								<td colspan="5" height="20" align="right"><b>Organisation Unit:</b></td>
								<td  colspan="3" id="selectedOUName">&nbsp;</td>
								
								<td colspan="4" align="right"><b>Year: </b></td>
								<td  colspan="2" id="period">&nbsp;</td>
							</tr>

		  
							<tr>

								<!-- <div id="load" style="font-size: 26px">Report Loading . . .Please wait</div>-->
								<table id="datavalue1" border="1" cellspacing="6" cellpadding="4" width="100%"
									   style="border-collapse:collapse; border:2px; font-weight:bolder;
			border-spacing: 0;">
								</table>

							</tr>
						</table>
		</div>
</div>